(()=>{"use strict";var e={1020:(e,t,a)=>{var r=a(1609),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,a){var r,s={},d=null,l=null;for(r in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:n,type:e,key:d,ref:l,props:s,_owner:i.current}}t.Fragment=s,t.jsx=d,t.jsxs=d},1609:e=>{e.exports=window.React},4848:(e,t,a)=>{e.exports=a(1020)}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=a(1609),n=a.n(r);const s=window.jQuery;var o=a.n(s);window.lodash;const i=window.wc.wcBlocksRegistry,c=window.wp.i18n,d=(e,t,a,r,n=null)=>{try{if(null==e)return null;const o={baseConfig:{apiKey:e.apiKey,enviroment:e.enviroment},paymentParams:{amount:e.amount,currency:e.divisa,url:"",urlPost:"",urlBack:""},customParams:{},language:e.language};if(1===a){const t={buyer:{},destinationAddress:{},billingAddress:{},cardHolderAcctInfo:{}};""!==e.Buyer_email&&(t.buyer.email=e.Buyer_email),""!==e.Buyer_homePhone&&(t.buyer.homePhone=e.Buyer_homePhone),""!==e.Buyer_account&&(t.buyer.account=e.Buyer_account),""!==e.Dest_city&&(t.destinationAddress.city=e.Dest_city),""!==e.Dest_country&&(t.destinationAddress.countryCode=e.Dest_country),""!==e.Dest_street&&(t.destinationAddress.street=e.Dest_street),""!==e.Dest_street2&&(t.destinationAddress.street2=e.Dest_street2),""!==e.Dest_cap&&(t.destinationAddress.postalCode=e.Dest_cap),""!==e.Dest_state&&(t.destinationAddress.stateCode=e.Dest_state),""!==e.Bill_city&&(t.billingAddress.city=e.Bill_city),""!==e.Bill_country&&(t.billingAddress.countryCode=e.Bill_country),""!==e.Bill_street&&(t.billingAddress.street=e.Bill_street),""!==e.Bill_street2&&(t.billingAddress.street2=e.Bill_street2),""!==e.Bill_cap&&(t.billingAddress.postalCode=e.Bill_cap),""!==e.Bill_state&&(t.billingAddress.stateCode=e.Bill_state),""!==e.chAccDate&&(t.cardHolderAcctInfo.chAccDate=e.chAccDate),""!==e.chAccAgeIndicator&&(t.cardHolderAcctInfo.chAccAgeIndicator=e.chAccAgeIndicator),""!==e.nbPurchaseAccount&&(t.cardHolderAcctInfo.nbPurchaseAccount=e.nbPurchaseAccount),""!==e.destinationAddressUsageDate&&(t.cardHolderAcctInfo.destinationAddressUsageDate=e.destinationAddressUsageDate),""!==e.destinationNameIndicator&&(t.cardHolderAcctInfo.destinationNameIndicator=e.destinationNameIndicator),0===Object.keys(t.buyer).length&&delete t.buyer,0===Object.keys(t.destinationAddress).length&&delete t.destinationAddress,0===Object.keys(t.billingAddress).length&&delete t.billingAddress,0===Object.keys(t.cardHolderAcctInfo).length&&delete t.cardHolderAcctInfo,o.informazioniSicurezza=t}var s;null!==n?(o.paymentParams.transactionId=n.cod_trans_cvv,o.paymentParams.timeStamp=n.timestamp_cvv,o.paymentParams.mac=n.mac_cvv,o.customParams.num_contratto=""+n.name,o.serviceType="paga_oc3d",o.requestType="PR",s=XPay.OPERATION_TYPES.CARD):(o.paymentParams.transactionId=e.transactionId,o.paymentParams.timeStamp=e.timestamp,o.paymentParams.mac=e.mac,s=XPay.OPERATION_TYPES.SPLIT_CARD),XPay.setConfig(o);const i=XPay.create(s,t);return null!==n?(document.getElementById(r).innerHTML="",i.mount(r)):(document.getElementById("xpay-pan").innerHTML="",document.getElementById("xpay-expiry").innerHTML="",document.getElementById("xpay-cvv").innerHTML="",i.mount("xpay-pan","xpay-expiry","xpay-cvv")),i}catch(e){console.error(e)}return null};var l=a(4848);const u=()=>{const e=wc?.wcSettings?.getSetting("xpay_build_data",null);if(!e)throw new Error("xpay_build initialization data is not available");return e},y=()=>{var e;return null!==(e=u()?.can_make_payment)&&void 0!==e&&e},p=()=>{var e;return null!==(e=u()?.content)&&void 0!==e?e:""},m=()=>{var e;return null!==(e=u()?.admin_url)&&void 0!==e?e:""},v=()=>{var e;return null!==(e=u()?.border_color_ok)&&void 0!==e?e:""},_=()=>{var e;return null!==(e=u()?.border_color_ko)&&void 0!==e?e:""},x=()=>{var e;return null!==(e=u()?.enable_3ds20)&&void 0!==e?e:""},g=()=>{var e;return null!==(e=u()?.payment_payload)&&void 0!==e?e:""},w=()=>{var e;return null!==(e=u()?.build_style)&&void 0!==e?e:""},f=({label:e,icons:t,components:a})=>{const{PaymentMethodLabel:r,PaymentMethodIcons:n}=a;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r,{text:e}),n&&t.length>0&&(0,l.jsx)(n,{icons:t,align:"right"})]})},h=({eventRegistration:e,shouldSavePayment:t,emitResponse:a})=>{const{onPaymentSetup:s,onCheckoutFail:i,onShippingRateSelectSuccess:y}=e,f=null!==(h=u()?.recurring?.enabled)&&void 0!==h&&h;var h;const P=Object.entries(null!==(b=u()?.all_card_icons)&&void 0!==b?b:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})));var b;const[E,C]=n().useState(g()),A=(0,r.useRef)(null),[S,j]=(0,r.useState)(""),[R,T]=(0,r.useState)(v()),[I,O]=(0,r.useState)(!1);(0,r.useEffect)((()=>{I&&(f?XPay.updateConfig(A.current,{serviceType:"paga_multi",requestType:"PP"}):t?XPay.updateConfig(A.current,{serviceType:"paga_oc3d",requestType:"PP"}):XPay.updateConfig(A.current,{serviceType:"paga_oc3d",requestType:"PA"}))}),[t,f,I]);const B=n().useCallback((()=>{O(!1),o().ajax({type:"POST",data:{action:"build_payment_payload"},url:`${m()}admin-ajax.php`,success:function(e){C(e),XPay.init(),A.current=d(e,w(),x(),"xpay-card")}})}),[]);(0,r.useEffect)((()=>{B()}),[B]),(0,r.useEffect)((()=>y((()=>(B(),!0)))),[y,B]),(0,r.useEffect)((()=>i((()=>(B(),!0)))),[i,B]),(0,r.useEffect)((()=>{const e=()=>{O(!0)};return window.addEventListener("XPay_Ready",e),()=>{window.removeEventListener("XPay_Ready",e)}}),[]),(0,r.useEffect)((()=>{const e=e=>{e.detail.errorMessage?(j(e.detail.errorMessage),T(_())):(j(""),T(v()))};return window.addEventListener("XPay_Card_Error",e),()=>{window.removeEventListener("XPay_Card_Error",e)}}),[]);const k=n().useCallback((e=>(XPay.createNonce(null,e),new Promise(((e,t)=>{const a=r=>{"OK"===r.detail.esito?e(r.detail):t(r.detail),window.removeEventListener("XPay_Nonce",a)};window.addEventListener("XPay_Nonce",a);const r=e=>{e.detail.errorMessage?(j(e.detail.errorMessage),T(_()),t(e.detail)):(j(""),T(v())),window.removeEventListener("XPay_Card_Error",r)};window.addEventListener("XPay_Card_Error",r)})))),[]);return(0,r.useEffect)((()=>{const e=s((async()=>{try{var e,t,r;const n=await k(A.current);return{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:{xpay_nonce:n.xpayNonce,transaction_id:E.transactionId,divisa:E.divisa,brand_carta:null!==(e=n.dettaglioCarta?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=n.dettaglioCarta?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(r=n.dettaglioCarta?.scadenza)&&void 0!==r?r:""}}}}catch(e){var n=parseInt(e?.errore?.codice);let t=(0,c.__)("There was an error","woocommerce-gateway-nexi-xpay");return 600===n&&(t=(0,c.__)("Payment canceled","woocommerce-gateway-nexi-xpay")),{type:a.responseTypes.ERROR,message:t}}}));return()=>{e()}}),[a.responseTypes.ERROR,a.responseTypes.SUCCESS,s,k,E,A]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{children:p()}),(0,l.jsx)("div",{class:"nexixpay-loghi-container flex",children:(0,l.jsx)("div",{class:"internal-container",children:P.map((e=>(0,l.jsx)("div",{class:"img-container",children:(0,l.jsx)("img",{src:e.src,alt:e.alt})},e.id)))})}),(0,l.jsxs)("div",{class:"wc-credit-card-form wc-payment-form nexi-xpay-build",children:[(0,l.jsxs)("div",{style:{display:"table",marginBottom:"30px"},children:[(0,l.jsx)("div",{id:"xpay-pan",class:"xpay-card-container",style:{maxWidth:"300px",width:"100%",borderColor:R,marginBottom:"5px"}}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,l.jsx)("div",{id:"xpay-expiry",class:"xpay-card-container",style:{maxWidth:"147.5px",width:"100%",borderColor:R,borderTopWidth:"1",borderRightWidth:"1",marginRight:"5px"}}),(0,l.jsx)("div",{id:"xpay-cvv",class:"xpay-card-container",style:{maxWidth:"147.5px",width:"100%",borderColor:R,borderTopWidth:"1"}})]})]}),(0,l.jsx)("div",{id:"xpay-card-errors",children:S}),f&&(0,l.jsx)("div",{class:"reccurring-info-xpay",children:null!==(D=u()?.recurring?.disclaimer_text)&&void 0!==D?D:""})]})]});var D},P=({eventRegistration:e,token:t,emitResponse:a})=>{const[s,i]=n().useState(g()),{onPaymentSetup:u,onCheckoutFail:y,onShippingRateSelectSuccess:p}=e,[f,h]=(0,r.useState)(""),[P,b]=(0,r.useState)(v()),E=(0,r.useRef)(null),C=n().useCallback((()=>{o().ajax({type:"POST",data:{action:"build_payment_payload",token_id:t},url:`${m()}admin-ajax.php`,success:function(e){i(e),XPay.init(),E.current=d(e,w(),x(),"xpay-card-cvv-"+t,e.token_data)}})}),[t]);(0,r.useEffect)((()=>{C()}),[C]),(0,r.useEffect)((()=>p((()=>(C(),!0)))),[p,C]),(0,r.useEffect)((()=>y((()=>(C(),!0)))),[y,C]),(0,r.useEffect)((()=>p((()=>(C(),!0)))),[p,C]),(0,r.useEffect)((()=>{const e=e=>{e.detail.errorMessage?(h(e.detail.errorMessage),b(_())):(h(""),b(v()))};return window.addEventListener("XPay_Card_Error",e),()=>{window.removeEventListener("XPay_Card_Error",e)}}),[]);const A=n().useCallback((e=>(XPay.createNonce(null,e),new Promise(((e,t)=>{const a=r=>{"OK"===r.detail.esito?e(r.detail):t(r.detail),window.removeEventListener("XPay_Nonce",a)};window.addEventListener("XPay_Nonce",a);const r=e=>{e.detail.errorMessage?(h(e.detail.errorMessage),b(_()),t(e.detail)):(h(""),b(v())),window.removeEventListener("XPay_Card_Error",r)};window.addEventListener("XPay_Card_Error",r)})))),[]);return(0,r.useEffect)((()=>{const e=u((async()=>{try{var e,t,r;const n=await A(E.current);return{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:{xpay_nonce:n.xpayNonce,transaction_id:s.token_data.cod_trans_cvv,divisa:s.divisa,brand_carta:null!==(e=n.dettaglioCarta?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=n.dettaglioCarta?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(r=n.dettaglioCarta?.scadenza)&&void 0!==r?r:"","wc-xpay-new-payment-token":!1}}}}catch(e){var n=parseInt(e?.errore?.codice);let t=(0,c.__)("There was an error","woocommerce-gateway-nexi-xpay");return 600===n&&(t=(0,c.__)("Payment canceled","woocommerce-gateway-nexi-xpay")),{type:a.responseTypes.ERROR,message:t}}}));return()=>{e()}}),[a.responseTypes.ERROR,a.responseTypes.SUCCESS,u,A,s,E]),(0,l.jsxs)("div",{class:"wc-credit-card-form wc-payment-form nexi-xpay-build",children:[(0,l.jsx)("div",{class:"xpay-card-cvv xpay-card-container",style:{borderColor:P},id:"xpay-card-cvv-"+t}),(0,l.jsx)("div",{id:"xpay-card-errors",children:f})]})};(0,i.registerPaymentMethod)((()=>{const e=null!==(t=u()?.label)&&void 0!==t?t:"";var t;const a=Object.entries(null!==(r=u()?.icons)&&void 0!==r?r:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})));var r;const n=Object.entries(null!==(s=u()?.content_icons)&&void 0!==s?s:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})));var s,o,i,d;return{savedTokenComponent:(0,l.jsx)(P,{}),name:"xpay",content:(0,l.jsx)(h,{}),label:(0,l.jsx)(f,{label:e,icons:a}),edit:(0,l.jsx)(h,{content:p(),icons:n}),icons:a,canMakePayment:y,ariaLabel:(0,c.__)(e,"woocommerce-gateway-nexi-xpay"),supports:{showSavedCards:null!==(d=u()?.show_saved_cards)&&void 0!==d&&d,showSaveOption:null!==(i=u()?.show_save_option)&&void 0!==i&&i,features:null!==(o=u()?.features)&&void 0!==o?o:[]}}})())})();