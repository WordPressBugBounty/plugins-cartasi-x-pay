(()=>{"use strict";var e={1020:(e,t,a)=>{var n=a(1609),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,a){var n,i={},c=null,l=null;for(n in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)d.call(t,n)&&!s.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:l,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},1609:e=>{e.exports=window.React},4848:(e,t,a)=>{e.exports=a(1020)}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=a(1609),r=a.n(n);const i=window.jQuery;var d=a.n(i);window.lodash;const o=window.wc.wcBlocksRegistry,s=window.wp.i18n,c=".wc-block-components-checkout-place-order-button",l="#xpayNonce",u="form.wc-block-checkout__form",p=(e=void 0,t="xpay-card",a=!1)=>{try{const n=document.getElementById("xpay_new_payment_info");if(null==n||void 0===e)return;const r=n.value,i=JSON.parse(r),o={baseConfig:{apiKey:i.apiKey,enviroment:i.enviroment},paymentParams:{amount:i.amount,currency:i.divisa,url:"",urlPost:"",urlBack:""},customParams:{},language:i.language},s={buyer:{},destinationAddress:{},billingAddress:{},cardHolderAcctInfo:{}};if(""!==i.Buyer_email&&(s.buyer.email=i.Buyer_email),""!==i.Buyer_homePhone&&(s.buyer.homePhone=i.Buyer_homePhone),""!==i.Buyer_account&&(s.buyer.account=i.Buyer_account),""!==i.Dest_city&&(s.destinationAddress.city=i.Dest_city),""!==i.Dest_country&&(s.destinationAddress.countryCode=i.Dest_country),""!==i.Dest_street&&(s.destinationAddress.street=i.Dest_street),""!==i.Dest_street2&&(s.destinationAddress.street2=i.Dest_street2),""!==i.Dest_cap&&(s.destinationAddress.postalCode=i.Dest_cap),""!==i.Dest_state&&(s.destinationAddress.stateCode=i.Dest_state),""!==i.Bill_city&&(s.billingAddress.city=i.Bill_city),""!==i.Bill_country&&(s.billingAddress.countryCode=i.Bill_country),""!==i.Bill_street&&(s.billingAddress.street=i.Bill_street),""!==i.Bill_street2&&(s.billingAddress.street2=i.Bill_street2),""!==i.Bill_cap&&(s.billingAddress.postalCode=i.Bill_cap),""!==i.Bill_state&&(s.billingAddress.stateCode=i.Bill_state),""!==i.chAccDate&&(s.cardHolderAcctInfo.chAccDate=i.chAccDate),""!==i.chAccAgeIndicator&&(s.cardHolderAcctInfo.chAccAgeIndicator=i.chAccAgeIndicator),""!==i.nbPurchaseAccount&&(s.cardHolderAcctInfo.nbPurchaseAccount=i.nbPurchaseAccount),""!==i.destinationAddressUsageDate&&(s.cardHolderAcctInfo.destinationAddressUsageDate=i.destinationAddressUsageDate),""!==i.destinationNameIndicator&&(s.cardHolderAcctInfo.destinationNameIndicator=i.destinationNameIndicator),0===Object.keys(s.buyer).length&&delete s.buyer,0===Object.keys(s.destinationAddress).length&&delete s.destinationAddress,0===Object.keys(s.billingAddress).length&&delete s.billingAddress,0===Object.keys(s.cardHolderAcctInfo).length&&delete s.cardHolderAcctInfo,1===parseInt(document.getElementById("xpay_build_3ds").value)&&(o.informazioniSicurezza=s),a){const e=d()("#"+t);o.paymentParams.transactionId=e.attr("data-codTransCvv"),o.paymentParams.timeStamp=e.attr("data-timestampCvv"),o.paymentParams.mac=e.attr("data-macCvv"),o.customParams.num_contratto=""+e.attr("data-token"),o.serviceType="paga_oc3d",o.requestType="PR"}else o.paymentParams.transactionId=i.transactionId,o.paymentParams.timeStamp=i.timestamp,o.paymentParams.mac=i.mac;XPay.setConfig(o);const c=JSON.parse(d()("#xpay_build_style").val());e[t]=XPay.create(XPay.OPERATION_TYPES.CARD,c),document.getElementById(t).innerHTML="",e[t].mount(t)}catch(e){console.error(e)}},y=(e,t=()=>{},a=()=>{},n=()=>{},r=()=>{},i=()=>{},o=()=>{})=>{d()(window).off("XPay_Nonce"),d()(window).on("XPay_Nonce",(function(s){let p=s.detail;if(p.esito&&"OK"===p.esito){d()(e).prop("disabled",!1),d()(l).val(p.xpayNonce),t(p.idOperazione),a(p.timeStamp),n(p.esito),r(p.mac);const o={};for(const e in p.dettaglioCarta)o[e]=p.dettaglioCarta[e];i(o),d()(c).trigger("click")}else{o("["+p.errore.codice+"] "+p.errore.messaggio),d()(e).prop("disabled",!1);const t='<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">\n<ul class="woocommerce-error" role="alert"><li>'+d()("#xpay_msg_err").val()+"</li></ul></div>";d()(u).prepend(t),d()("html,body").animate({scrollTop:0},"slow"),d()("body").trigger("update_checkout")}}))},m=(e,t,a=()=>{},n=()=>{})=>{d()(window).off("XPay_Card_Error"),d()(window).on("XPay_Card_Error",(function(r){r.detail.errorMessage?(a(r.detail.errorMessage),n(t)):(a(""),n(e))}))},v=e=>{d()(document.body).on("checkout_error",(function(){d()(e).is(":checked")&&0!==d()(l).val().length&&(d()(u).trigger("update"),d()(l).val(""))}))},_=(e=()=>{})=>{d()((function(){((e=()=>{})=>{0!==d()(c).length&&(d()(c).off(),d()(c).on("click",(function(){return e()})))})(e)}))};var x=a(4848);const h=(e,t)=>{const a=wc?.wcSettings?.getSetting(e+"_data",null);if(!a)throw new Error(e+" initialization data is not available");return a},f=e=>{var t;return null!==(t=h(e)?.can_make_payment)&&void 0!==t&&t},b=e=>{var t;return Object.entries(null!==(t=h(e)?.content_icons)&&void 0!==t?t:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})))},g=e=>{var t;return null!==(t=h(e)?.content)&&void 0!==t?t:""},w=e=>{var t;return null!==(t=h(e)?.features)&&void 0!==t?t:[]},j=e=>{var t;return null!==(t=h(e)?.show_saved_cards)&&void 0!==t&&t},P=e=>{var t;return null!==(t=h(e)?.show_save_option)&&void 0!==t&&t},S=e=>{var t;return null!==(t=h(e)?.recurring?.enabled)&&void 0!==t&&t},A=e=>{var t;return null!==(t=h(e)?.recurring?.disclaimer_text)&&void 0!==t?t:""},I=e=>{var t;return null!==(t=h(e)?.admin_url)&&void 0!==t?t:""},k=e=>{var t;return null!==(t=h(e)?.error_message)&&void 0!==t?t:""},O=e=>{var t;return null!==(t=h(e)?.border_color_ok)&&void 0!==t?t:""},C=e=>{var t;return null!==(t=h(e)?.border_color_ko)&&void 0!==t?t:""},N=e=>{var t;return null!==(t=h(e)?.enable_3ds20)&&void 0!==t?t:""},B=e=>{var t;return null!==(t=h(e)?.payment_payload)&&void 0!==t?t:""},E=e=>{var t;return null!==(t=h(e)?.build_style)&&void 0!==t?t:""},D=({label:e,icons:t,components:a})=>{const{PaymentMethodLabel:n,PaymentMethodIcons:r}=a;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(n,{text:e}),r&&t.length>0&&(0,x.jsx)(r,{icons:t,align:"right"})]})},T=({paymentMethodName:e,components:t,eventRegistration:a,shouldSavePayment:i})=>{const o="#radio-control-wc-payment-method-options-xpay_build",{PaymentMethodIcons:s}=t,{onPaymentSetup:c}=a,u=E(e),h=b(e),f=S(e),[w,j]=(0,n.useState)(B(e)),[P,I]=(0,n.useState)({}),[D,T]=(0,n.useState)(""),[M,z]=(0,n.useState)(O(e)),[R,X]=(0,n.useState)(!1),[H,L]=(0,n.useState)(null),[U,F]=(0,n.useState)(""),[J,K]=(0,n.useState)(""),[q,G]=(0,n.useState)(""),[Y,$]=(0,n.useState)("");(0,n.useEffect)((()=>{if(i===R)return;X(i);let e="PA";i&&(e="PP"),XPay.updateConfig(P["xpay-card"],{serviceType:"paga_oc3d",requestType:e}),I(P)}),[i,R]);const Q=r().useCallback((()=>{d()(o).is(":checked")&&(XPay.init(),I((e=>(p(e),e))))}),[o]),W=r().useCallback((()=>{if(d()(o).is(":checked"))return 0!==d()(l).val().length||(d()("#xpay_build_num_contratto").val(d()("#xpay_build_num_contratto").attr("data-new-card-value")),j((e=>(e.transactionId=d()("#xpay_build_transactionId").attr("data-new-card-value"),e))),I((t=>(XPay.createNonce("wc-"+e+"-cc-form",t["xpay-card"]),t))),!1)}),[o,l]);return(0,n.useEffect)((()=>{y(o,F,K,G,$,L,T),m(O(e),C(e),T,z),v(o),_(W),Q()}),[Q,W]),(0,n.useEffect)((()=>c((()=>async function(){var e,t,a;return{type:"success",meta:{paymentMethodData:{xpay_nonce:d()(l).val(),transaction_id:w.transactionId,divisa:w.divisa,brand_carta:null!==(e=H?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=H?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(a=H?.scadenza)&&void 0!==a?a:""}}}}()))),[c,w,H]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{children:g(e)}),s&&h.length>0&&(0,x.jsx)(s,{contentIcons:h,align:"right"}),(0,x.jsxs)("fieldset",{id:"wc-"+e+"-cc-form",class:"wc-credit-card-form wc-payment-form",children:[(0,x.jsx)("input",{type:"hidden",id:"xpay_msg_err",value:k(e)}),(0,x.jsx)("input",{type:"hidden",id:"xpay_new_payment_info",value:JSON.stringify(w)}),(0,x.jsx)("input",{type:"hidden",name:"divisa",value:w.divisa}),(0,x.jsx)("input",{type:"hidden",name:"transactionId",id:"xpay_build_transactionId","data-new-card-value":w.transactionId}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_style",value:u}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_3ds",value:N(e)}),(0,x.jsx)("div",{id:"xpay-card",style:{border:"1px solid "+M,padding:"3px;","max-width":"420px;"}}),(0,x.jsx)("div",{id:"xpay-card-errors",children:D}),(0,x.jsx)("br",{}),(0,x.jsx)("input",{type:"hidden",name:"xpayNonce",id:"xpayNonce"}),(0,x.jsx)("input",{type:"hidden",name:"xpayIdOperazione",id:"xpayIdOperazione",value:U}),(0,x.jsx)("input",{type:"hidden",name:"xpayTimeStamp",id:"xpayTimeStamp",value:J}),(0,x.jsx)("input",{type:"hidden",name:"xpayEsito",id:"xpayEsito",value:q}),(0,x.jsx)("input",{type:"hidden",name:"xpayMac",id:"xpayMac",value:Y}),f&&A(e),(0,x.jsx)("div",{class:"clear"})]})]})},M=({paymentMethodName:e,eventRegistration:t,token:a})=>{const i="#radio-control-wc-payment-method-saved-tokens-"+a,[o,s]=(0,n.useState)(B(e)),c=E(e),u=S(e),{onPaymentSetup:h}=t,[f,b]=(0,n.useState)(""),[g,w]=(0,n.useState)(""),[j,P]=(0,n.useState)(""),[D,T]=(0,n.useState)(""),[M,z]=(0,n.useState)(""),[R,X]=(0,n.useState)(O(e)),[H,L]=(0,n.useState)(null),[U,F]=(0,n.useState)(null),[J,K]=(0,n.useState)({}),q=r().useCallback((()=>{d()(i).is(":checked")&&(XPay.init(),K((e=>(p(e,"xpay-card-cvv-"+a,!0),e))))}),[i]),G=r().useCallback((()=>{if(d()(i).is(":checked")){if(0===d()(l).val().length){const t=d()("div[data-wc-id='"+a+"']"),n="xpay-card-cvv-"+a;return s((e=>(e.transactionId=t.attr("data-codTransCvv"),e))),d()("#xpay_build_num_contratto").val(""),K((t=>(XPay.createNonce("wc-"+e+"-cc-form",t[n]),t))),!1}return!0}}),[i,l]);return(0,n.useEffect)((()=>h((()=>async function(){var e,t,a;return{type:"success",meta:{paymentMethodData:{xpay_nonce:d()(l).val(),transaction_id:o.transactionId,divisa:o.divisa,brand_carta:null!==(e=U?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=U?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(a=U?.scadenza)&&void 0!==a?a:"","wc-xpay_build-new-payment-token":!1}}}}()))),[h,o,U]),(0,n.useEffect)((()=>{y(i,b,w,P,T,F,z),m(O(e),C(e),z,X),v(i),_(G),d().ajax({type:"POST",data:{action:"xpay_build_block_checkout_token_data",token_id:a},url:I(e)+"admin-ajax.php",success:function(e){L(e)},complete:function(){}})}),[G,i]),(0,n.useEffect)((()=>{null!==H&&q()}),[H,q]),(0,x.jsxs)("fieldset",{id:"wc-"+e+"-cc-form",class:"wc-credit-card-form wc-payment-form",children:[(0,x.jsx)("input",{type:"hidden",id:"xpay_msg_err",value:k(e)}),(0,x.jsx)("input",{type:"hidden",id:"xpay_new_payment_info",value:JSON.stringify(o)}),(0,x.jsx)("input",{type:"hidden",name:"divisa",value:o.divisa}),(0,x.jsx)("input",{type:"hidden",name:"transactionId",id:"xpay_build_transactionId","data-new-card-value":o.transactionId}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_style",value:c}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_border_color_default",value:O(e)}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_border_color_error",value:C(e)}),(0,x.jsx)("input",{type:"hidden",id:"xpay_build_3ds",value:N(e)}),(0,x.jsx)("div",{id:"xpay-card",style:{border:"1px solid "+R,padding:"3px;","max-width":"420px;"},children:(0,x.jsx)("div",{class:"xpay-card-cvv",id:"xpay-card-cvv-"+a,"data-wc-id":a,"data-token":H?.name,"data-codTransCvv":H?.cod_trans_cvv,"data-timestampCvv":H?.timestamp_cvv,"data-macCvv":H?.mac_cvv,style:H?.style})}),(0,x.jsx)("div",{id:"xpay-card-errors",children:M}),(0,x.jsx)("br",{}),(0,x.jsx)("input",{type:"hidden",name:"xpayNonce",id:"xpayNonce"}),(0,x.jsx)("input",{type:"hidden",name:"xpayIdOperazione",id:"xpayIdOperazione",value:f}),(0,x.jsx)("input",{type:"hidden",name:"xpayTimeStamp",id:"xpayTimeStamp",value:g}),(0,x.jsx)("input",{type:"hidden",name:"xpayEsito",id:"xpayEsito",value:j}),(0,x.jsx)("input",{type:"hidden",name:"xpayMac",id:"xpayMac",value:D}),u&&A(e),(0,x.jsx)("div",{class:"clear"})]})};(0,o.registerPaymentMethod)(((e,t)=>{let a=()=>f(e);void 0!==t&&(a=()=>{f(e)&&t()});const n=(e=>{var t;return null!==(t=h(e)?.label)&&void 0!==t?t:""})(e),r=(e=>{var t;return Object.entries(null!==(t=h(e)?.icons)&&void 0!==t?t:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})))})(e),i=b(e);return{savedTokenComponent:(0,x.jsx)(M,{paymentMethodName:e}),name:e,content:(0,x.jsx)(T,{paymentMethodName:e}),label:(0,x.jsx)(D,{label:n,icons:r}),edit:(0,x.jsx)(T,{content:g(e),icons:i}),icons:r,canMakePayment:a,ariaLabel:(0,s.__)(n,"woocommerce-gateway-nexi-xpay"),supports:{showSavedCards:j(e),showSaveOption:P(e),features:w(e)}}})("xpay_build"))})();