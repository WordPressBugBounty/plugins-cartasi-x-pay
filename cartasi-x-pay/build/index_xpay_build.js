(()=>{"use strict";var e={1020:(e,t,a)=>{var r=a(1609),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,a){var r,s={},d=null,l=null;for(r in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!i.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:n,type:e,key:d,ref:l,props:s,_owner:c.current}}t.Fragment=s,t.jsx=d,t.jsxs=d},1609:e=>{e.exports=window.React},4848:(e,t,a)=>{e.exports=a(1020)}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=a(1609),n=a.n(r);const s=window.jQuery;var o=a.n(s);window.lodash;const c=window.wc.wcBlocksRegistry,i=window.wp.i18n,d=(e,t,a,r,n=null)=>{try{if(null==e)return null;const s={baseConfig:{apiKey:e.apiKey,enviroment:e.enviroment},paymentParams:{amount:e.amount,currency:e.divisa,url:"",urlPost:"",urlBack:""},customParams:{},language:e.language};if(1===a){const t={buyer:{},destinationAddress:{},billingAddress:{},cardHolderAcctInfo:{}};""!==e.Buyer_email&&(t.buyer.email=e.Buyer_email),""!==e.Buyer_homePhone&&(t.buyer.homePhone=e.Buyer_homePhone),""!==e.Buyer_account&&(t.buyer.account=e.Buyer_account),""!==e.Dest_city&&(t.destinationAddress.city=e.Dest_city),""!==e.Dest_country&&(t.destinationAddress.countryCode=e.Dest_country),""!==e.Dest_street&&(t.destinationAddress.street=e.Dest_street),""!==e.Dest_street2&&(t.destinationAddress.street2=e.Dest_street2),""!==e.Dest_cap&&(t.destinationAddress.postalCode=e.Dest_cap),""!==e.Dest_state&&(t.destinationAddress.stateCode=e.Dest_state),""!==e.Bill_city&&(t.billingAddress.city=e.Bill_city),""!==e.Bill_country&&(t.billingAddress.countryCode=e.Bill_country),""!==e.Bill_street&&(t.billingAddress.street=e.Bill_street),""!==e.Bill_street2&&(t.billingAddress.street2=e.Bill_street2),""!==e.Bill_cap&&(t.billingAddress.postalCode=e.Bill_cap),""!==e.Bill_state&&(t.billingAddress.stateCode=e.Bill_state),""!==e.chAccDate&&(t.cardHolderAcctInfo.chAccDate=e.chAccDate),""!==e.chAccAgeIndicator&&(t.cardHolderAcctInfo.chAccAgeIndicator=e.chAccAgeIndicator),""!==e.nbPurchaseAccount&&(t.cardHolderAcctInfo.nbPurchaseAccount=e.nbPurchaseAccount),""!==e.destinationAddressUsageDate&&(t.cardHolderAcctInfo.destinationAddressUsageDate=e.destinationAddressUsageDate),""!==e.destinationNameIndicator&&(t.cardHolderAcctInfo.destinationNameIndicator=e.destinationNameIndicator),0===Object.keys(t.buyer).length&&delete t.buyer,0===Object.keys(t.destinationAddress).length&&delete t.destinationAddress,0===Object.keys(t.billingAddress).length&&delete t.billingAddress,0===Object.keys(t.cardHolderAcctInfo).length&&delete t.cardHolderAcctInfo,s.informazioniSicurezza=t}null!==n?(s.paymentParams.transactionId=n.cod_trans_cvv,s.paymentParams.timeStamp=n.timestamp_cvv,s.paymentParams.mac=n.mac_cvv,s.customParams.num_contratto=""+n.name,s.serviceType="paga_oc3d",s.requestType="PR"):(s.paymentParams.transactionId=e.transactionId,s.paymentParams.timeStamp=e.timestamp,s.paymentParams.mac=e.mac),XPay.setConfig(s);const o=XPay.create(XPay.OPERATION_TYPES.CARD,t);return document.getElementById(r).innerHTML="",o.mount(r),o}catch(e){console.error(e)}return null};var l=a(4848);const u=()=>{const e=wc?.wcSettings?.getSetting("xpay_build_data",null);if(!e)throw new Error("xpay_build initialization data is not available");return e},y=()=>{var e;return null!==(e=u()?.can_make_payment)&&void 0!==e&&e},p=()=>{var e;return Object.entries(null!==(e=u()?.content_icons)&&void 0!==e?e:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})))},_=()=>{var e;return null!==(e=u()?.content)&&void 0!==e?e:""},m=()=>{var e;return null!==(e=u()?.admin_url)&&void 0!==e?e:""},v=()=>{var e;return null!==(e=u()?.border_color_ok)&&void 0!==e?e:""},g=()=>{var e;return null!==(e=u()?.border_color_ko)&&void 0!==e?e:""},w=()=>{var e;return null!==(e=u()?.enable_3ds20)&&void 0!==e?e:""},f=()=>{var e;return null!==(e=u()?.payment_payload)&&void 0!==e?e:""},P=()=>{var e;return null!==(e=u()?.build_style)&&void 0!==e?e:""},x=({label:e,icons:t,components:a})=>{const{PaymentMethodLabel:r,PaymentMethodIcons:n}=a;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r,{text:e}),n&&t.length>0&&(0,l.jsx)(n,{icons:t,align:"right"})]})},b=({components:e,eventRegistration:t,shouldSavePayment:a,emitResponse:s})=>{const{PaymentMethodIcons:c}=e,{onPaymentProcessing:y,onCheckoutFail:x,onShippingRateSelectSuccess:b}=t,h=p(),E=null!==(C=u()?.recurring?.enabled)&&void 0!==C&&C;var C;const[A,S]=n().useState(f()),j=(0,r.useRef)(null),[R,I]=(0,r.useState)(""),[O,T]=(0,r.useState)(v()),[k,X]=(0,r.useState)(!1);(0,r.useEffect)((()=>{k&&(E?XPay.updateConfig(j.current,{serviceType:"paga_multi",requestType:"PP"}):a?XPay.updateConfig(j.current,{serviceType:"paga_oc3d",requestType:"PP"}):XPay.updateConfig(j.current,{serviceType:"paga_oc3d",requestType:"PA"}))}),[a,E,k]);const D=n().useCallback((()=>{o().ajax({type:"POST",data:{action:"build_payment_payload"},url:`${m()}admin-ajax.php`,success:function(e){S(e),XPay.init(),j.current=d(e,P(),w(),"xpay-card")}})}),[]);(0,r.useEffect)((()=>{D()}),[D]),(0,r.useEffect)((()=>b((()=>(D(),!0)))),[b,D]),(0,r.useEffect)((()=>x((()=>(D(),!0)))),[x,D]),(0,r.useEffect)((()=>{const e=()=>{X(!0)};return window.addEventListener("XPay_Ready",e),()=>{window.removeEventListener("XPay_Ready",e)}}),[]),(0,r.useEffect)((()=>{const e=e=>{e.detail.errorMessage?(I(e.detail.errorMessage),T(g())):(I(""),T(v()))};return window.addEventListener("XPay_Card_Error",e),()=>{window.removeEventListener("XPay_Card_Error",e)}}),[]);const B=n().useCallback((e=>(XPay.createNonce(null,e),new Promise(((e,t)=>{const a=r=>{"OK"===r.detail.esito?e(r.detail):t(r.detail),window.removeEventListener("XPay_Nonce",a)};window.addEventListener("XPay_Nonce",a);const r=e=>{e.detail.errorMessage?(I(e.detail.errorMessage),T(g()),t(e.detail)):(I(""),T(v())),window.removeEventListener("XPay_Card_Error",r)};window.addEventListener("XPay_Card_Error",r)})))),[]);return(0,r.useEffect)((()=>{const e=y((async()=>{try{var e,t,a;const r=await B(j.current);return{type:s.responseTypes.SUCCESS,meta:{paymentMethodData:{xpay_nonce:r.xpayNonce,transaction_id:A.transactionId,divisa:A.divisa,brand_carta:null!==(e=r.dettaglioCarta?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=r.dettaglioCarta?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(a=r.dettaglioCarta?.scadenza)&&void 0!==a?a:""}}}}catch(e){var r=parseInt(e?.errore?.codice);let t=(0,i.__)("There was an error","woocommerce-gateway-nexi-xpay");return 600===r&&(t=(0,i.__)("Payment canceled","woocommerce-gateway-nexi-xpay")),{type:s.responseTypes.ERROR,message:t}}}));return()=>{e()}}),[s.responseTypes.ERROR,s.responseTypes.SUCCESS,y,B,A,j]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{children:_()}),c&&h.length>0&&(0,l.jsx)(c,{contentIcons:h,align:"right"}),(0,l.jsxs)("div",{class:"wc-credit-card-form wc-payment-form nexi-xpay-build",children:[(0,l.jsx)("div",{id:"xpay-card",class:"xpay-card-container",style:{borderColor:O}}),(0,l.jsx)("div",{id:"xpay-card-errors",children:R}),E&&(0,l.jsx)("div",{class:"reccurring-info-xpay",children:null!==(L=u()?.recurring?.disclaimer_text)&&void 0!==L?L:""})]})]});var L},h=({eventRegistration:e,token:t,emitResponse:a})=>{const[s,c]=n().useState(f()),{onPaymentProcessing:u,onCheckoutFail:y,onShippingRateSelectSuccess:p}=e,[_,x]=(0,r.useState)(""),[b,h]=(0,r.useState)(v()),E=(0,r.useRef)(null),C=n().useCallback((()=>{o().ajax({type:"POST",data:{action:"build_payment_payload",token_id:t},url:`${m()}admin-ajax.php`,success:function(e){c(e),XPay.init(),E.current=d(e,P(),w(),"xpay-card-cvv-"+t,e.token_data)}})}),[t]);(0,r.useEffect)((()=>{C()}),[C]),(0,r.useEffect)((()=>y((()=>(C(),!0)))),[y,C]),(0,r.useEffect)((()=>p((()=>(C(),!0)))),[p,C]),(0,r.useEffect)((()=>{const e=e=>{e.detail.errorMessage?(x(e.detail.errorMessage),h(g())):(x(""),h(v()))};return window.addEventListener("XPay_Card_Error",e),()=>{window.removeEventListener("XPay_Card_Error",e)}}),[]);const A=n().useCallback((e=>(XPay.createNonce(null,e),new Promise(((e,t)=>{const a=r=>{"OK"===r.detail.esito?e(r.detail):t(r.detail),window.removeEventListener("XPay_Nonce",a)};window.addEventListener("XPay_Nonce",a);const r=e=>{e.detail.errorMessage?(x(e.detail.errorMessage),h(g()),t(e.detail)):(x(""),h(v())),window.removeEventListener("XPay_Card_Error",r)};window.addEventListener("XPay_Card_Error",r)})))),[]);return(0,r.useEffect)((()=>{const e=u((async()=>{try{var e,t,r;const n=await A(E.current);return{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:{xpay_nonce:n.xpayNonce,transaction_id:s.token_data.cod_trans_cvv,divisa:s.divisa,brand_carta:null!==(e=n.dettaglioCarta?.brand)&&void 0!==e?e:"",pan_carta:null!==(t=n.dettaglioCarta?.pan)&&void 0!==t?t:"",scadenza_carta:null!==(r=n.dettaglioCarta?.scadenza)&&void 0!==r?r:"","wc-xpay_build-new-payment-token":!1}}}}catch(e){var n=parseInt(e?.errore?.codice);let t=(0,i.__)("There was an error","woocommerce-gateway-nexi-xpay");return 600===n&&(t=(0,i.__)("Payment canceled","woocommerce-gateway-nexi-xpay")),{type:a.responseTypes.ERROR,message:t}}}));return()=>{e()}}),[a.responseTypes.ERROR,a.responseTypes.SUCCESS,u,A,s,E]),(0,l.jsxs)("div",{class:"wc-credit-card-form wc-payment-form nexi-xpay-build",children:[(0,l.jsx)("div",{class:"xpay-card-cvv xpay-card-container",style:{borderColor:b},id:"xpay-card-cvv-"+t}),(0,l.jsx)("div",{id:"xpay-card-errors",children:_})]})};(0,c.registerPaymentMethod)((()=>{const e=null!==(t=u()?.label)&&void 0!==t?t:"";var t;const a=Object.entries(null!==(r=u()?.icons)&&void 0!==r?r:[]).map((([e,{src:t,alt:a}])=>({id:e,src:t,alt:a})));var r;const n=p();var s,o,c;return{savedTokenComponent:(0,l.jsx)(h,{}),name:"xpay_build",content:(0,l.jsx)(b,{}),label:(0,l.jsx)(x,{label:e,icons:a}),edit:(0,l.jsx)(b,{content:_(),icons:n}),icons:a,canMakePayment:y,ariaLabel:(0,i.__)(e,"woocommerce-gateway-nexi-xpay"),supports:{showSavedCards:null!==(c=u()?.show_saved_cards)&&void 0!==c&&c,showSaveOption:null!==(o=u()?.show_save_option)&&void 0!==o&&o,features:null!==(s=u()?.features)&&void 0!==s?s:[]}}})())})();