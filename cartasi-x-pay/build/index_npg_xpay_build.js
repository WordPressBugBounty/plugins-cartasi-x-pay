(()=>{"use strict";var e={1020:(e,t,r)=>{var n=r(1609),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,d=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function s(e,t,r){var n,a={},s=null,l=null;for(n in void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(l=t.ref),t)i.call(t,n)&&!c.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:o,type:e,key:s,ref:l,props:a,_owner:d.current}}t.Fragment=a,t.jsx=s,t.jsxs=s},1609:e=>{e.exports=window.React},4848:(e,t,r)=>{e.exports=r(1020)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=r(1609);const o=window.jQuery;var a=r.n(o);const i=window.wc.wcBlocksRegistry,d=window.wp.i18n;var c=r(4848);const s=(e,t)=>{const r=wc?.wcSettings?.getSetting(e+"_data",null);if(!r)throw new Error(e+" initialization data is not available");return r},l=e=>{var t;return null!==(t=s(e)?.can_make_payment)&&void 0!==t&&t},u=e=>{var t;return Object.entries(null!==(t=s(e)?.content_icons)&&void 0!==t?t:[]).map((([e,{src:t,alt:r}])=>({id:e,src:t,alt:r})))},p=e=>{var t;return null!==(t=s(e)?.content)&&void 0!==t?t:""},v=e=>{var t;return null!==(t=s(e)?.features)&&void 0!==t?t:[]},m=e=>{var t;return null!==(t=s(e)?.show_saved_cards)&&void 0!==t&&t},f=e=>{var t;return null!==(t=s(e)?.show_save_option)&&void 0!==t&&t},h=e=>{var t;return null!==(t=s(e)?.recurring?.disclaimer_text)&&void 0!==t?t:""},_=({label:e,icons:t,components:r})=>{const{PaymentMethodLabel:n,PaymentMethodIcons:o}=r;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n,{text:e}),o&&t.length>0&&(0,c.jsx)(o,{icons:t,align:"right"})]})},b=({paymentMethodName:e,eventRegistration:t,components:r})=>{const{PaymentMethodIcons:o}=r,{onPaymentSetup:i}=t,d=u(e),l=(e=>{var t;return null!==(t=s(e)?.recurring?.enabled)&&void 0!==t&&t})(e),v=(e=>{var t;return null!==(t=s(e)?.admin_url)&&void 0!==t?t:""})(e),m=(e=>{var t;return null!==(t=s(e)?.validation_error)&&void 0!==t?t:""})(e),f=(e=>{var t;return null!==(t=s(e)?.session_error)&&void 0!==t?t:""})(e),[_,b]=(0,n.useState)(""),[x,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(!1),[g,E]=(0,n.useState)(""),[k,R]=(0,n.useState)(!1),O=function(){a()(".wc-block-components-checkout-place-order-button").attr("disabled",!0)},S=function(){a()(".build-field-row").each((function(e,t){a()(t).children("div").children("iframe").each((function(e,t){a()(t).remove()}))}))};return(0,n.useEffect)((()=>{w(!0);const e=setInterval((()=>{"xpay_build"==a()('input[name="radio-control-wc-payment-method-options"]:checked').val()?a()(".wc-block-components-checkout-place-order-button").attr("disabled",!0):a()(".wc-block-components-checkout-place-order-button").attr("disabled",!1)}),500);setTimeout((()=>{clearInterval(e)}),2e3)}),[]),(0,n.useEffect)((()=>i((()=>async function(){return{type:"success",meta:{paymentMethodData:{npg_order_id:_}}}}()))),[i,_]),(0,n.useEffect)((()=>{a()("form.wc-block-checkout__form").on("change",'input[name="radio-control-wc-payment-method-options"]',(function(){"xpay_build"==a()('input[name="radio-control-wc-payment-method-options"]:checked').val()?a()(".wc-block-components-checkout-place-order-button").attr("disabled",!0):a()(".wc-block-components-checkout-place-order-button").attr("disabled",!1)})),window.addEventListener("message",(function(e){"event"in e.data&&"state"in e.data&&"BUILD_FLOW_STATE_CHANGE"===e.data.event&&"READY_FOR_PAYMENT"===e.data.state&&a()(".wc-block-components-checkout-place-order-button").attr("disabled",!1),"BUILD_ERROR"===e.data.event?"HF0001"==e.data.errorCode?E(a()("#validation-error").val()):"HF0003"==e.data.errorCode?E(a()("#session-error").val()):console.error(e.data):E("")}))}),[]),(0,n.useEffect)((()=>{y||(j(!0),"xpay_build"==a()('input[name="payment_method"]:checked').val()||"xpay_build"==a()('input[name="radio-control-wc-payment-method-options"]:checked').val()?(a()("#wc-xpay_build-cc-form").hide(),R(!0),E(""),S(),a().ajax({type:"POST",data:{action:"get_build_fields",orderId:`${a()("#npg-orderId").val()}`},url:`${v}admin-ajax.php`,beforeSend:function(){R(!0),O()},success:function(e){if(O(),R(!1),e.error_msg)a()(".npg-build-error-msg-container").html(`<p>${e.error_msg}</p>`);else{b(e.orderId);let t=e.fields;for(const e of t){let t=document.createElement("iframe");t.src=e.src,t.className="iframe-field",a()(`#${e.id}`).append(t)}a()("#wc-xpay_build-cc-form").show()}},complete:function(){R(!1)}})):a()(".wc-block-components-checkout-place-order-button").attr("disabled",!1))}),[x,y,j,b,v,a()]),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{children:p(e)}),o&&d.length>0&&(0,c.jsx)(o,{contentIcons:d,align:"right"}),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"hidden",id:"xpay_admin_url",value:v}),k&&(0,c.jsx)("div",{class:"loader-container",children:(0,c.jsx)("p",{class:"loading"})}),(0,c.jsxs)("fieldset",{id:"wc-"+e+"-cc-form",class:"wc-credit-card-form wc-payment-form",children:[(0,c.jsx)("input",{type:"hidden",id:"npg-orderId",name:"orderId",value:""}),(0,c.jsx)("input",{type:"hidden",id:"validation-error",value:m}),(0,c.jsx)("input",{type:"hidden",id:"session-error",value:f}),(0,c.jsx)("div",{class:"build-field-row",children:(0,c.jsx)("div",{id:"CARD_NUMBER"})}),(0,c.jsxs)("div",{class:"build-field-row",children:[(0,c.jsx)("div",{id:"EXPIRATION_DATE"}),(0,c.jsx)("div",{id:"SECURITY_CODE"})]}),(0,c.jsxs)("div",{class:"build-field-row",children:[(0,c.jsx)("div",{id:"CARDHOLDER_NAME"}),(0,c.jsx)("div",{id:"CARDHOLDER_SURNAME"})]}),(0,c.jsx)("div",{class:"build-field-row",children:(0,c.jsx)("div",{id:"CARDHOLDER_EMAIL"})})]}),(0,c.jsx)("div",{class:"npg-build-error-msg-container",children:g})]}),l&&(0,c.jsx)("div",{children:(0,c.jsx)("span",{children:h(e)})})]})};(0,i.registerPaymentMethod)(((e,t)=>{let r=()=>l(e);void 0!==t&&(r=()=>{l(e)&&t()});const n=(e=>{var t;return null!==(t=s(e)?.label)&&void 0!==t?t:""})(e),o=(e=>{var t;return Object.entries(null!==(t=s(e)?.icons)&&void 0!==t?t:[]).map((([e,{src:t,alt:r}])=>({id:e,src:t,alt:r})))})(e),a=u(e);return{name:e,content:(0,c.jsx)(b,{paymentMethodName:e}),label:(0,c.jsx)(_,{label:n,icons:o}),edit:(0,c.jsx)(b,{content:p(e),icons:a}),icons:o,canMakePayment:r,ariaLabel:(0,d.__)(n,"woocommerce-gateway-nexi-xpay"),supports:{showSavedCards:m(e),showSaveOption:f(e),features:v(e)}}})("xpay_build"))})();