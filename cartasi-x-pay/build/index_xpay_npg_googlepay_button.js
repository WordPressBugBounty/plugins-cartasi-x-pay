(()=>{"use strict";var e={1020:(e,t,n)=>{var o=n(1609),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,s=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var o,r={},l=null,u=null;for(o in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)c.call(t,o)&&!i.hasOwnProperty(o)&&(r[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===r[o]&&(r[o]=t[o]);return{$$typeof:a,type:e,key:l,ref:u,props:r,_owner:s.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},1609:e=>{e.exports=window.React},4848:(e,t,n)=>{e.exports=n(1020)}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=n(1609),a=n.n(o);const r=window.jQuery;var c=n.n(r);const s=window.wc.wcBlocksRegistry,i=window.wp.data,l=window.wp.i18n;var u=n(4848);const d=()=>{const e=wc?.wcSettings?.getSetting("xpay_npg_googlepay_button_data",null);if(!e)throw new Error("xpay_npg_googlepay_button initialization data is not available");return e},p=()=>{var e;return null!==(e=d()?.can_make_payment)&&void 0!==e&&e},y=()=>{var e;return Object.entries(null!==(e=d()?.content_icons)&&void 0!==e?e:[]).map((([e,{src:t,alt:n}])=>({id:e,src:t,alt:n})))},g=({label:e,icons:t,components:n})=>{const{PaymentMethodLabel:o,PaymentMethodIcons:a}=n;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o,{text:e}),a&&t.length>0&&(0,u.jsx)(a,{icons:t,align:"right"})]})},m={apiVersion:2,apiVersionMinor:0};function _(e){return{type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:e.cards}}}const f=({eventRegistration:e,emitResponse:t,onSubmit:n,components:o})=>{const{PaymentMethodIcons:r}=o,s=y(),{onPaymentSetup:p,onShippingRateSelectSuccess:g}=e;a().useEffect((()=>g((()=>(I(),!0)))),[g]),a().useEffect((()=>(c()(".wc-block-components-checkout-place-order-button").hide(),()=>{c()(".wc-block-components-checkout-place-order-button").show()})),[]);const f=a().useRef(null),{validationStore:w}=window.wc.wcBlocksData,b=(0,i.useSelect)((e=>e(w))),h=a().useCallback((e=>{if(!b.hasValidationErrors()){const t=C(e);n(),f.current.loadPaymentData(t).then((function(t){const n=new CustomEvent("xpay_google_pay_update",{detail:{status:"OK",paymentData:t,transactionId:e.transactionId}});window.dispatchEvent(n)})).catch((function(e){if(console.error(e),(""+e).includes("User closed the Payment Request UI")){const e=new CustomEvent("xpay_google_pay_update",{detail:{status:"KO",user_abort_ui:!0}});window.dispatchEvent(e)}else{const e=new CustomEvent("xpay_google_pay_update",{detail:{status:"KO"}});window.dispatchEvent(e)}}))}}),[b]),v=a().useCallback((e=>{const t=f.current.createButton({onClick:function(){h(e)},buttonSizeMode:"fill",buttonColor:e.config.button_color,buttonType:e.config.button_type,buttonLocale:e.config.button_locale}),n=document.getElementById("googlepay-button-container");n&&n.appendChild(t)}),[]),C=a().useCallback((e=>{const t=Object.assign({emailRequired:!0},m);return t.allowedPaymentMethods=[Object.assign({},_(e),{tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:e.config.gateway,gatewayMerchantId:e.config.gateway_merchant_id}}})],t.transactionInfo={countryCode:e.transactionInfo.countryCode,currencyCode:e.transactionInfo.currencyCode,totalPriceStatus:"FINAL",totalPrice:e.transactionInfo.totalPrice},e.config.test_mode?t.merchantInfo={merchantName:e.config.merchant_name}:t.merchantInfo={merchantId:e.config.merchant_id,merchantName:e.config.merchant_name},t}),[]),x=a().useCallback((e=>{const t=C(e);t.transactionInfo={countryCode:e.transactionInfo.countryCode,currencyCode:e.transactionInfo.currencyCode,totalPriceStatus:"FINAL",totalPrice:e.transactionInfo.totalPrice},f.current.prefetchPaymentData(t)}),[]),I=a().useCallback((()=>{const e=document.getElementById("googlepay-button-container");var t;e&&(e.innerHTML=""),c().ajax({type:"POST",data:{action:"google_pay_configuration"},url:`${null!==(t=d()?.admin_url)&&void 0!==t?t:""}admin-ajax.php`,beforeSend:function(){c().blockUI({message:""})},success:function(e){c().unblockUI(),e.config.test_mode?f.current=new google.payments.api.PaymentsClient({environment:"TEST"}):f.current=new google.payments.api.PaymentsClient({environment:"PRODUCTION"});const t=Object.assign({},m,{allowedPaymentMethods:[_(e)]});f.current.isReadyToPay(t).then((function(t){c().unblockUI(),t.result&&(v(e),x(e))})).catch((function(e){c().unblockUI(),console.error(e)}))},complete:function(){c().unblockUI()}})}),[]);a().useEffect((()=>{I()}),[I]);const P=a().useCallback((async()=>new Promise(((e,t)=>{const n=o=>{"OK"===o.detail.status?e(o.detail):t(o.detail),window.removeEventListener("xpay_google_pay_update",n)};window.addEventListener("xpay_google_pay_update",n)}))),[]);return a().useEffect((()=>{const e=p((async()=>{try{const e=await P();return{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:{transaction_id:e.transactionId,google_pay_json:JSON.stringify(e.paymentData)}}}}catch(e){return"user_abort_ui"in e&&e.user_abort_ui?{type:t.responseTypes.ERROR}:{type:t.responseTypes.ERROR,message:(0,l.__)("There was an error","woocommerce-gateway-nexi-xpay")}}}));return()=>{e()}}),[t.responseTypes.SUCCESS,t.responseTypes.ERROR,p,P]),(0,u.jsxs)("div",{children:[r&&s.length>0&&(0,u.jsx)(r,{contentIcons:s,align:"right"}),(0,u.jsx)("div",{id:"googlepay-button-container"})]})};(0,s.registerPaymentMethod)((()=>{const e=null!==(t=d()?.label)&&void 0!==t?t:"";var t;const n=Object.entries(null!==(o=d()?.icons)&&void 0!==o?o:[]).map((([e,{src:t,alt:n}])=>({id:e,src:t,alt:n})));var o;const a=y();var r,c;return{name:"xpay_npg_googlepay_button",content:(0,u.jsx)(f,{}),label:(0,u.jsx)(g,{label:e,icons:n}),edit:(0,u.jsx)(f,{content:null!==(c=d()?.content)&&void 0!==c?c:"",icons:a}),icons:n,canMakePayment:p,ariaLabel:(0,l.__)(e,"woocommerce-gateway-nexi-xpay"),supports:{showSavedCards:!1,showSaveOption:!1,features:null!==(r=d()?.features)&&void 0!==r?r:[]}}})())})();